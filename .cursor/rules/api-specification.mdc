---
description: api specification
globs: 
alwaysApply: false
---
# ìµœì €ê°€ ì‡¼í•‘ Agent - API ëª…ì„¸ì„œ

## ğŸ“‹ API ê°œìš”

ì´ ë¬¸ì„œëŠ” [product-requirements-document.mdc](mdc:.cursor/rules/product-requirements-document.mdc)ì™€ [technical-architecture.mdc](mdc:.cursor/rules/technical-architecture.mdc)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ FastAPI ì„œë²„ì˜ REST API ëª…ì„¸ì…ë‹ˆë‹¤.

## ğŸ”— Base URL
```
http://localhost:8000/api/v1
```

## ğŸ› ï¸ í•µì‹¬ API ì—”ë“œí¬ì¸íŠ¸

### ì±—ë´‡ ëŒ€í™” API (Streaming)

#### POST /chat
LangGraph Agentì™€ì˜ ëŒ€í™”í˜• ìƒí˜¸ì‘ìš© (Server-Sent Events ìŠ¤íŠ¸ë¦¬ë°)

**Request:**
```json
{
  "message": "ì•„ì´í° 15 ìµœì €ê°€ ì°¾ì•„ì¤˜",
  "session_id": "uuid",
  "message_type": "text"
}
```

**Response Headers:**
```
Content-Type: text/event-stream
Cache-Control: no-cache
Connection: keep-alive
```

**Streaming Response:**
- ì•„ì§ í™•ì •ë˜ì§€ ì•Šì•˜ìœ¼ë©° ê°œë°œ ì¤‘ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
data: {"type": "start", "session_id": "uuid", "timestamp": "2024-01-01T00:00:00Z"}

data: {"type": "message", "content": "ì•„ì´í° 15ë¥¼ ê²€ìƒ‰í•˜ê³  ìˆìŠµë‹ˆë‹¤... ğŸ”", "timestamp": "2024-01-01T00:00:01Z"}

data: {"type": "action", "action": "search_products", "status": "processing", "timestamp": "2024-01-01T00:00:02Z"}

data: {"type": "products", "data": [{"id": "uuid", "name": "ì•„ì´í° 15 Pro 256GB", "prices": [{"shop": "coupang", "price": 1350000, "url": "https://..."}]}], "timestamp": "2024-01-01T00:00:05Z"}

data: {"type": "message", "content": "ì´ 5ê°œ ì‡¼í•‘ëª°ì—ì„œ ì•„ì´í° 15ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤. ìµœì €ê°€ëŠ” ì¿ íŒ¡ì—ì„œ 135ë§Œì›ì…ë‹ˆë‹¤!", "timestamp": "2024-01-01T00:00:06Z"}

data: {"type": "complete", "session_id": "uuid", "timestamp": "2024-01-01T00:00:07Z"}
```

#### POST /chat/image
ì´ë¯¸ì§€ê°€ í¬í•¨ëœ ì±—ë´‡ ëŒ€í™” (Streaming)

**Request:**
```
Content-Type: multipart/form-data
- message: "ì´ ìƒí’ˆ ìµœì €ê°€ ì°¾ì•„ì¤˜"
- image: [ì´ë¯¸ì§€ íŒŒì¼]
- session_id: "uuid"
```

**Streaming Response:**
- ì•„ì§ í™•ì •ë˜ì§€ ì•Šì•˜ìœ¼ë©° ê°œë°œ ì¤‘ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
data: {"type": "start", "session_id": "uuid", "timestamp": "2024-01-01T00:00:00Z"}

data: {"type": "message", "content": "ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤... ğŸ“¸", "timestamp": "2024-01-01T00:00:01Z"}

data: {"type": "action", "action": "image_analysis", "status": "processing", "timestamp": "2024-01-01T00:00:02Z"}

data: {"type": "image_result", "identified_product": "ì•„ì´í° 15 Pro", "confidence": 0.95, "timestamp": "2024-01-01T00:00:04Z"}

data: {"type": "message", "content": "ì•„ì´í° 15 Proë¡œ ì¸ì‹ë˜ì—ˆìŠµë‹ˆë‹¤. ê°€ê²©ì„ ê²€ìƒ‰í•˜ê³  ìˆìŠµë‹ˆë‹¤...", "timestamp": "2024-01-01T00:00:05Z"}

data: {"type": "products", "data": [...], "timestamp": "2024-01-01T00:00:08Z"}

data: {"type": "complete", "session_id": "uuid", "timestamp": "2024-01-01T00:00:09Z"}
```

## ğŸ”§ ìŠ¤íŠ¸ë¦¬ë° ì´ë²¤íŠ¸ íƒ€ì…
- ì•„ì§ í™•ì •ë˜ì§€ ì•Šì•˜ìœ¼ë©° ê°œë°œ ì¤‘ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
### ê¸°ë³¸ ì´ë²¤íŠ¸
| íƒ€ì… | ì„¤ëª… | ë°ì´í„° |
|------|------|--------|
| `start` | ìŠ¤íŠ¸ë¦¼ ì‹œì‘ | `session_id`, `timestamp` |
| `message` | í…ìŠ¤íŠ¸ ë©”ì‹œì§€ | `content`, `timestamp` |
| `complete` | ìŠ¤íŠ¸ë¦¼ ì™„ë£Œ | `session_id`, `timestamp` |
| `error` | ì—ëŸ¬ ë°œìƒ | `error_code`, `message`, `timestamp` |

### ì•¡ì…˜ ì´ë²¤íŠ¸
| íƒ€ì… | ì„¤ëª… | ë°ì´í„° |
|------|------|--------|
| `action` | ì•¡ì…˜ ì‹¤í–‰ ìƒíƒœ | `action`, `status`, `timestamp` |
| `products` | ìƒí’ˆ ê²€ìƒ‰ ê²°ê³¼ | `data[]`, `timestamp` |
| `price_comparison` | ê°€ê²© ë¹„êµ ê²°ê³¼ | `data[]`, `timestamp` |
| `image_result` | ì´ë¯¸ì§€ ë¶„ì„ ê²°ê³¼ | `identified_product`, `confidence`, `timestamp` |


## ğŸ¯ ì—ëŸ¬ ìŠ¤íŠ¸ë¦¬ë°

ì—ëŸ¬ ë°œìƒ ì‹œ ìŠ¤íŠ¸ë¦¼ì„ í†µí•´ ì—ëŸ¬ ì •ë³´ ì „ì†¡:

```
data: {"type": "error", "error_code": "PRODUCT_NOT_FOUND", "message": "ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "timestamp": "2024-01-01T00:00:00Z"}
```

## ğŸ’¡ í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„ ì˜ˆì‹œ


### Python (Streamlit)
```python
import requests
import json

def stream_chat(message, session_id):
    response = requests.post(
        '/api/v1/chat',
        json={'message': message, 'session_id': session_id},
        stream=True,
    )
    
    for line in response.iter_lines():
        if line.startswith(b'data: '):
            data = json.loads(line[6:])
            yield data

```