---
description:
globs:
alwaysApply: false
---
# 5ë‹¨ê³„: Streamlit ì±—ë´‡ UI êµ¬í˜„

## ğŸ¯ ëª©í‘œ
ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ êµ¬ì¶• - ì „ì²´ í™”ë©´ ì±„íŒ… ì¸í„°í˜ì´ìŠ¤, ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì²˜ë¦¬, ìƒí’ˆ ì¹´ë“œ í‘œì‹œ

## ğŸ“‹ ìƒì„¸ íƒœìŠ¤í¬

### 5.1 í”„ë¡œì íŠ¸ êµ¬ì¡° í™•ì¥

```
src/ui/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ streamlit_app.py
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ chat_interface.py
â”‚   â”œâ”€â”€ product_card.py
â”‚   â”œâ”€â”€ price_comparison.py
â”‚   â””â”€â”€ sidebar.py
â”œâ”€â”€ styles/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.css
â”‚   â””â”€â”€ components.css
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ api_client.py
â”‚   â””â”€â”€ session_manager.py
â””â”€â”€ config/
    â”œâ”€â”€ __init__.py
    â””â”€â”€ ui_config.py
```

### 5.2 ë©”ì¸ Streamlit ì•± êµ¬í˜„

#### ë©”ì¸ ì•± (`src/ui/streamlit_app.py`)
```python
import streamlit as st
import asyncio
import uuid
from datetime import datetime
from typing import Dict, Any, List

from .components.chat_interface import ChatInterface
from .components.sidebar import Sidebar
from .utils.api_client import APIClient
from .utils.session_manager import SessionManager
from .config.ui_config import UIConfig

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(
    page_title="ğŸ›’ PriceFinder Agent",
    page_icon="ğŸ›’",
    layout="wide",
    initial_sidebar_state="collapsed"
)

# CSS ìŠ¤íƒ€ì¼ ë¡œë“œ
def load_css():
    """CSS ìŠ¤íƒ€ì¼ ë¡œë“œ"""
    with open("src/ui/styles/main.css", "r", encoding="utf-8") as f:
        st.markdown(f"<style>{f.read()}</style>", unsafe_allow_html=True)

class PriceFinderApp:
    """PriceFinder Streamlit ì•± ë©”ì¸ í´ë˜ìŠ¤"""
    
    def __init__(self):
        self.config = UIConfig()
        self.session_manager = SessionManager()
        self.api_client = APIClient()
        self.chat_interface = ChatInterface()
        self.sidebar = Sidebar()
        
        # ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”
        self._initialize_session_state()
    
    def _initialize_session_state(self):
        """ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”"""
        if "session_id" not in st.session_state:
            st.session_state.session_id = str(uuid.uuid4())
        
        if "messages" not in st.session_state:
            st.session_state.messages = []
        
        if "search_history" not in st.session_state:
            st.session_state.search_history = []
        
        if "current_products" not in st.session_state:
            st.session_state.current_products = []
        
        if "is_processing" not in st.session_state:
            st.session_state.is_processing = False
    
    def run(self):
        """ì•± ì‹¤í–‰"""
        # CSS ë¡œë“œ
        load_css()
        
        # í—¤ë” ë Œë”ë§
        self._render_header()
        
        # ë©”ì¸ ì»¨í…Œì´ë„ˆ
        main_container = st.container()
        
        with main_container:
            # ì±„íŒ… ì¸í„°í˜ì´ìŠ¤
            col1, col2 = st.columns([3, 1])
            
            with col1:
                self._render_chat_area()
            
            with col2:
                self._render_sidebar()
        
        # ì…ë ¥ ì˜ì—­ (í•˜ë‹¨ ê³ ì •)
        self._render_input_area()
    
    def _render_header(self):
        """í—¤ë” ë Œë”ë§"""
        st.markdown("""
        <div class="header-container">
            <div class="header-content">
                <h1>ğŸ›’ PriceFinder Agent</h1>
                <p>AIê°€ ë„ì™€ì£¼ëŠ” ìŠ¤ë§ˆíŠ¸ ìµœì €ê°€ ì‡¼í•‘</p>
            </div>
        </div>
        """, unsafe_allow_html=True)
    
    def _render_chat_area(self):
        """ì±„íŒ… ì˜ì—­ ë Œë”ë§"""
        st.markdown('<div class="chat-container">', unsafe_allow_html=True)
        
        # í™˜ì˜ ë©”ì‹œì§€ (ì²« ë°©ë¬¸ ì‹œ)
        if not st.session_state.messages:
            self._show_welcome_message()
        
        # ë©”ì‹œì§€ í‘œì‹œ
        for message in st.session_state.messages:
            self.chat_interface.render_message(message)
        
        # ì²˜ë¦¬ ì¤‘ í‘œì‹œ
        if st.session_state.is_processing:
            self.chat_interface.render_processing_indicator()
        
        st.markdown('</div>', unsafe_allow_html=True)
    
    def _render_sidebar(self):
        """ì‚¬ì´ë“œë°” ë Œë”ë§"""
        self.sidebar.render(
            search_history=st.session_state.search_history,
            current_products=st.session_state.current_products
        )
    
    def _render_input_area(self):
        """ì…ë ¥ ì˜ì—­ ë Œë”ë§"""
        st.markdown('<div class="input-container">', unsafe_allow_html=True)
        
        # ì…ë ¥ ì»¨í…Œì´ë„ˆ
        input_container = st.container()
        
        with input_container:
            col1, col2, col3 = st.columns([6, 1, 1])
            
            with col1:
                user_input = st.chat_input(
                    placeholder="ìƒí’ˆì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”... (ì˜ˆ: ì•„ì´í° 15 ìµœì €ê°€)",
                    disabled=st.session_state.is_processing
                )
            
            with col2:
                image_upload = st.file_uploader(
                    "ğŸ“·",
                    type=['png', 'jpg', 'jpeg'],
                    help="ìƒí’ˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ",
                    label_visibility="collapsed"
                )
            
            with col3:
                if st.button("ğŸ”„", help="ìƒˆë¡œìš´ ëŒ€í™” ì‹œì‘"):
                    self._reset_conversation()
        
        # ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬
        if user_input:
            self._handle_user_input(user_input)
        
        if image_upload:
            self._handle_image_upload(image_upload)
        
        st.markdown('</div>', unsafe_allow_html=True)
    
    def _show_welcome_message(self):
        """í™˜ì˜ ë©”ì‹œì§€ í‘œì‹œ"""
        welcome_message = {
            "role": "assistant",
            "content": """
ì•ˆë…•í•˜ì„¸ìš”! ğŸ›’ **PriceFinder Agent**ì…ë‹ˆë‹¤.

ì €ëŠ” ì—¬ëŸ¬ ì‡¼í•‘ëª°ì—ì„œ ìµœì €ê°€ë¥¼ ì°¾ì•„ë“œë¦¬ëŠ” AI ì–´ì‹œìŠ¤í„´íŠ¸ì˜ˆìš”.

### ğŸ” ì´ëŸ° ê²ƒë“¤ì„ ë„ì™€ë“œë¦´ ìˆ˜ ìˆì–´ìš”:
- **ìƒí’ˆ ê²€ìƒ‰**: "ì•„ì´í° 15 ìµœì €ê°€ ì°¾ì•„ì¤˜"
- **ê°€ê²© ë¹„êµ**: "ì‚¼ì„± ê°¤ëŸ­ì‹œ S24 ê°€ê²© ë¹„êµí•´ì¤˜"  
- **ì´ë¯¸ì§€ ê²€ìƒ‰**: ìƒí’ˆ ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ì„œ ê²€ìƒ‰
- **ìƒì„¸ ì •ë³´**: ë¦¬ë·°, ë°°ì†¡ë¹„, í• ì¸ ì •ë³´ ë“±

### ğŸ’¡ ê²€ìƒ‰ íŒ:
- ë¸Œëœë“œëª…ê³¼ ëª¨ë¸ëª…ì„ í•¨ê»˜ ì…ë ¥í•˜ë©´ ë” ì •í™•í•´ìš”
- "ìµœì €ê°€", "ê°€ê²© ë¹„êµ" ë“±ì˜ í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•´ë³´ì„¸ìš”

ê¶ê¸ˆí•œ ìƒí’ˆì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë§ì”€í•´ ì£¼ì„¸ìš”! ğŸ˜Š
            """,
            "timestamp": datetime.now(),
            "type": "welcome"
        }
        
        self.chat_interface.render_message(welcome_message)
    
    def _handle_user_input(self, user_input: str):
        """ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬"""
        # ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
        user_message = {
            "role": "user",
            "content": user_input,
            "timestamp": datetime.now()
        }
        st.session_state.messages.append(user_message)
        
        # ê²€ìƒ‰ íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
        st.session_state.search_history.append({
            "query": user_input,
            "timestamp": datetime.now()
        })
        
        # API í˜¸ì¶œ ë° ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì²˜ë¦¬
        self._process_user_message(user_input)
    
    def _handle_image_upload(self, image_file):
        """ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬"""
        # ì´ë¯¸ì§€ ë©”ì‹œì§€ ì¶”ê°€
        image_message = {
            "role": "user",
            "content": "ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí–ˆìŠµë‹ˆë‹¤.",
            "image": image_file,
            "timestamp": datetime.now()
        }
        st.session_state.messages.append(image_message)
        
        # ì´ë¯¸ì§€ ê²€ìƒ‰ ì²˜ë¦¬
        self._process_image_search(image_file)
    
    def _process_user_message(self, message: str):
        """ì‚¬ìš©ì ë©”ì‹œì§€ ì²˜ë¦¬ ë° API í˜¸ì¶œ"""
        st.session_state.is_processing = True
        
        try:
            # API ìŠ¤íŠ¸ë¦¬ë° í˜¸ì¶œ
            response_placeholder = st.empty()
            
            # ë¹„ë™ê¸° ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬
            asyncio.run(self._stream_response(message, response_placeholder))
            
        except Exception as e:
            st.error(f"ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}")
        
        finally:
            st.session_state.is_processing = False
    
    async def _stream_response(self, message: str, placeholder):
        """ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì²˜ë¦¬"""
        assistant_message = {
            "role": "assistant",
            "content": "",
            "timestamp": datetime.now(),
            "products": [],
            "type": "response"
        }
        
        try:
            # API í´ë¼ì´ì–¸íŠ¸ë¥¼ í†µí•œ ìŠ¤íŠ¸ë¦¬ë° í˜¸ì¶œ
            async for chunk in self.api_client.stream_chat(
                message=message,
                session_id=st.session_state.session_id
            ):
                # ìŠ¤íŠ¸ë¦¬ë° ë°ì´í„° ì²˜ë¦¬
                if chunk["type"] == "message":
                    assistant_message["content"] += chunk["data"].get("content", "")
                
                elif chunk["type"] == "products":
                    assistant_message["products"] = chunk["data"]
                    st.session_state.current_products = chunk["data"]
                
                elif chunk["type"] == "agent_result":
                    # Agent ê²°ê³¼ ì²˜ë¦¬
                    result_data = chunk["data"]
                    if "search_results" in result_data:
                        assistant_message["products"] = result_data["search_results"]
                        st.session_state.current_products = result_data["search_results"]
                
                # ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
                with placeholder.container():
                    self.chat_interface.render_message(assistant_message)
        
        except Exception as e:
            assistant_message["content"] = f"ì£„ì†¡í•©ë‹ˆë‹¤. ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}"
        
        # ìµœì¢… ë©”ì‹œì§€ ì €ì¥
        st.session_state.messages.append(assistant_message)
    
    async def _process_image_search(self, image_file):
        """ì´ë¯¸ì§€ ê²€ìƒ‰ ì²˜ë¦¬"""
        st.session_state.is_processing = True
        
        try:
            # ì´ë¯¸ì§€ ê²€ìƒ‰ API í˜¸ì¶œ (7ë‹¨ê³„ì—ì„œ êµ¬í˜„)
            st.info("ì´ë¯¸ì§€ ê²€ìƒ‰ ê¸°ëŠ¥ì€ 7ë‹¨ê³„ì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤.")
            
        except Exception as e:
            st.error(f"ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}")
        
        finally:
            st.session_state.is_processing = False
    
    def _reset_conversation(self):
        """ëŒ€í™” ì´ˆê¸°í™”"""
        st.session_state.messages = []
        st.session_state.current_products = []
        st.session_state.session_id = str(uuid.uuid4())
        st.rerun()

# ì•± ì‹¤í–‰
if __name__ == "__main__":
    app = PriceFinderApp()
    app.run()
```

### 5.3 ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ ì»´í¬ë„ŒíŠ¸

#### ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ (`src/ui/components/chat_interface.py`)
```python
import streamlit as st
from datetime import datetime
from typing import Dict, Any, List
from .product_card import ProductCard
from .price_comparison import PriceComparison

class ChatInterface:
    """ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ ì»´í¬ë„ŒíŠ¸"""
    
    def __init__(self):
        self.product_card = ProductCard()
        self.price_comparison = PriceComparison()
    
    def render_message(self, message: Dict[str, Any]):
        """ë©”ì‹œì§€ ë Œë”ë§"""
        role = message.get("role", "user")
        content = message.get("content", "")
        timestamp = message.get("timestamp", datetime.now())
        message_type = message.get("type", "text")
        
        if role == "user":
            self._render_user_message(message)
        else:
            self._render_assistant_message(message)
    
    def _render_user_message(self, message: Dict[str, Any]):
        """ì‚¬ìš©ì ë©”ì‹œì§€ ë Œë”ë§"""
        with st.chat_message("user", avatar="ğŸ‘¤"):
            content = message.get("content", "")
            
            # ì´ë¯¸ì§€ê°€ ìˆëŠ” ê²½ìš°
            if "image" in message:
                col1, col2 = st.columns([1, 3])
                with col1:
                    st.image(message["image"], width=100)
                with col2:
                    st.markdown(content)
            else:
                st.markdown(content)
            
            # íƒ€ì„ìŠ¤íƒ¬í”„
            timestamp = message.get("timestamp", datetime.now())
            st.caption(f"ğŸ• {timestamp.strftime('%H:%M')}")
    
    def _render_assistant_message(self, message: Dict[str, Any]):
        """ì–´ì‹œìŠ¤í„´íŠ¸ ë©”ì‹œì§€ ë Œë”ë§"""
        with st.chat_message("assistant", avatar="ğŸ›’"):
            content = message.get("content", "")
            products = message.get("products", [])
            message_type = message.get("type", "response")
            
            # ë©”ì‹œì§€ ë‚´ìš©
            if content:
                st.markdown(content)
            
            # ìƒí’ˆ ì •ë³´ê°€ ìˆëŠ” ê²½ìš°
            if products:
                self._render_products_section(products)
            
            # íƒ€ì„ìŠ¤íƒ¬í”„
            timestamp = message.get("timestamp", datetime.now())
            st.caption(f"ğŸ• {timestamp.strftime('%H:%M')}")
    
    def _render_products_section(self, products: List[Dict[str, Any]]):
        """ìƒí’ˆ ì„¹ì…˜ ë Œë”ë§"""
        if not products:
            return
        
        st.markdown("### ğŸ” ê²€ìƒ‰ ê²°ê³¼")
        
        # ìƒí’ˆ ì¹´ë“œë“¤
        for i, product in enumerate(products[:5]):  # ìµœëŒ€ 5ê°œê¹Œì§€ í‘œì‹œ
            self.product_card.render(product, index=i)
        
        # ë” ë§ì€ ê²°ê³¼ê°€ ìˆëŠ” ê²½ìš°
        if len(products) > 5:
            with st.expander(f"ë” ë³´ê¸° ({len(products) - 5}ê°œ ì¶”ê°€ ê²°ê³¼)"):
                for i, product in enumerate(products[5:], start=5):
                    self.product_card.render(product, index=i)
        
        # ê°€ê²© ë¹„êµ í…Œì´ë¸”
        if len(products) > 1:
            st.markdown("### ğŸ“Š ê°€ê²© ë¹„êµ")
            self.price_comparison.render(products)
    
    def render_processing_indicator(self):
        """ì²˜ë¦¬ ì¤‘ í‘œì‹œ"""
        with st.chat_message("assistant", avatar="ğŸ›’"):
            with st.spinner("ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤..."):
                st.markdown("ğŸ” ì—¬ëŸ¬ ì‡¼í•‘ëª°ì—ì„œ ìµœì €ê°€ë¥¼ ì°¾ê³  ìˆì–´ìš”...")
                
                # ì§„í–‰ ìƒí™© í‘œì‹œ
                progress_bar = st.progress(0)
                import time
                for i in range(100):
                    time.sleep(0.01)
                    progress_bar.progress(i + 1)
```

### 5.4 ìƒí’ˆ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸

#### ìƒí’ˆ ì¹´ë“œ (`src/ui/components/product_card.py`)
```python
import streamlit as st
from typing import Dict, Any

class ProductCard:
    """ìƒí’ˆ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸"""
    
    def render(self, product: Dict[str, Any], index: int = 0):
        """ìƒí’ˆ ì¹´ë“œ ë Œë”ë§"""
        name = product.get("name", "ìƒí’ˆëª… ì—†ìŒ")
        price = product.get("price", 0)
        shop = product.get("shop", "ì‡¼í•‘ëª°")
        url = product.get("url", "#")
        image_url = product.get("image_url", "")
        rating = product.get("rating", 0)
        review_count = product.get("review_count", 0)
        shipping_fee = product.get("shipping_fee", 0)
        discount_rate = product.get("discount_rate", 0)
        original_price = product.get("original_price", price)
        
        # ì¹´ë“œ ì»¨í…Œì´ë„ˆ
        with st.container():
            st.markdown(f"""
            <div class="product-card" style="
                border: 1px solid #e0e0e0;
                border-radius: 10px;
                padding: 15px;
                margin: 10px 0;
                background: white;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            ">
            """, unsafe_allow_html=True)
            
            col1, col2, col3 = st.columns([1, 3, 1])
            
            # ìƒí’ˆ ì´ë¯¸ì§€
            with col1:
                if image_url:
                    st.image(image_url, width=100)
                else:
                    st.markdown("""
                    <div style="
                        width: 100px;
                        height: 100px;
                        background: #f0f0f0;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 5px;
                    ">
                        ğŸ“¦
                    </div>
                    """, unsafe_allow_html=True)
            
            # ìƒí’ˆ ì •ë³´
            with col2:
                # ìƒí’ˆëª…
                st.markdown(f"**{name}**")
                
                # ì‡¼í•‘ëª°
                st.markdown(f"ğŸª {shop}")
                
                # ê°€ê²© ì •ë³´
                price_html = f"""
                <div style="margin: 10px 0;">
                    <span style="font-size: 24px; font-weight: bold; color: #e74c3c;">
                        {price:,}ì›
                    </span>
                """
                
                if discount_rate > 0:
                    price_html += f"""
                    <span style="margin-left: 10px; text-decoration: line-through; color: #7f8c8d;">
                        {original_price:,}ì›
                    </span>
                    <span style="margin-left: 5px; color: #e74c3c; font-weight: bold;">
                        {discount_rate:.1f}% í• ì¸
                    </span>
                    """
                
                price_html += "</div>"
                st.markdown(price_html, unsafe_allow_html=True)
                
                # ë°°ì†¡ë¹„
                if shipping_fee == 0:
                    st.markdown("ğŸšš **ë¬´ë£Œë°°ì†¡**")
                else:
                    st.markdown(f"ğŸšš ë°°ì†¡ë¹„: {shipping_fee:,}ì›")
                
                # í‰ì  ë° ë¦¬ë·°
                if rating > 0:
                    stars = "â­" * int(rating)
                    st.markdown(f"{stars} {rating:.1f} ({review_count:,}ê°œ ë¦¬ë·°)")
            
            # ì•¡ì…˜ ë²„íŠ¼
            with col3:
                # ì´ ê°€ê²© ê³„ì‚°
                total_price = price + shipping_fee
                st.markdown(f"""
                <div style="text-align: center; margin-bottom: 10px;">
                    <div style="font-size: 12px; color: #7f8c8d;">ì´ ê²°ì œê¸ˆì•¡</div>
                    <div style="font-size: 18px; font-weight: bold; color: #2c3e50;">
                        {total_price:,}ì›
                    </div>
                </div>
                """, unsafe_allow_html=True)
                
                # êµ¬ë§¤ ë²„íŠ¼
                if st.button(f"ğŸ›’ êµ¬ë§¤í•˜ê¸°", key=f"buy_{index}", use_container_width=True):
                    st.markdown(f'<meta http-equiv="refresh" content="0; url={url}">', 
                              unsafe_allow_html=True)
                
                # ìƒì„¸ë³´ê¸° ë²„íŠ¼
                if st.button(f"ğŸ“‹ ìƒì„¸ë³´ê¸°", key=f"detail_{index}", use_container_width=True):
                    self._show_product_details(product)
            
            st.markdown("</div>", unsafe_allow_html=True)
    
    def _show_product_details(self, product: Dict[str, Any]):
        """ìƒí’ˆ ìƒì„¸ ì •ë³´ ëª¨ë‹¬"""
        with st.expander("ğŸ“‹ ìƒí’ˆ ìƒì„¸ ì •ë³´", expanded=True):
            col1, col2 = st.columns(2)
            
            with col1:
                st.markdown("**ê¸°ë³¸ ì •ë³´**")
                st.write(f"ìƒí’ˆëª…: {product.get('name', 'N/A')}")
                st.write(f"ë¸Œëœë“œ: {product.get('brand', 'N/A')}")
                st.write(f"ì‡¼í•‘ëª°: {product.get('shop', 'N/A')}")
                st.write(f"ìƒí’ˆ ID: {product.get('id', 'N/A')}")
            
            with col2:
                st.markdown("**ê°€ê²© ì •ë³´**")
                st.write(f"íŒë§¤ê°€: {product.get('price', 0):,}ì›")
                st.write(f"ì •ê°€: {product.get('original_price', 0):,}ì›")
                st.write(f"í• ì¸ìœ¨: {product.get('discount_rate', 0):.1f}%")
                st.write(f"ë°°ì†¡ë¹„: {product.get('shipping_fee', 0):,}ì›")
            
            # ìƒí’ˆ ì„¤ëª…
            description = product.get('description', '')
            if description:
                st.markdown("**ìƒí’ˆ ì„¤ëª…**")
                st.write(description)
```

### 5.5 ê°€ê²© ë¹„êµ ì»´í¬ë„ŒíŠ¸

#### ê°€ê²© ë¹„êµ (`src/ui/components/price_comparison.py`)
```python
import streamlit as st
import pandas as pd
from typing import List, Dict, Any

class PriceComparison:
    """ê°€ê²© ë¹„êµ ì»´í¬ë„ŒíŠ¸"""
    
    def render(self, products: List[Dict[str, Any]]):
        """ê°€ê²© ë¹„êµ í…Œì´ë¸” ë Œë”ë§"""
        if len(products) < 2:
            return
        
        # ë°ì´í„° ì¤€ë¹„
        comparison_data = []
        for product in products:
            total_price = product.get('price', 0) + product.get('shipping_fee', 0)
            comparison_data.append({
                'ì‡¼í•‘ëª°': product.get('shop', 'N/A'),
                'ìƒí’ˆê°€ê²©': f"{product.get('price', 0):,}ì›",
                'ë°°ì†¡ë¹„': f"{product.get('shipping_fee', 0):,}ì›" if product.get('shipping_fee', 0) > 0 else "ë¬´ë£Œ",
                'ì´ ê¸ˆì•¡': f"{total_price:,}ì›",
                'í• ì¸ìœ¨': f"{product.get('discount_rate', 0):.1f}%" if product.get('discount_rate', 0) > 0 else "-",
                'í‰ì ': f"â­ {product.get('rating', 0):.1f}" if product.get('rating', 0) > 0 else "-",
                'ë¦¬ë·°ìˆ˜': f"{product.get('review_count', 0):,}ê°œ" if product.get('review_count', 0) > 0 else "-"
            })
        
        # DataFrame ìƒì„±
        df = pd.DataFrame(comparison_data)
        
        # ìµœì €ê°€ ì°¾ê¸°
        min_price_idx = min(range(len(products)), 
                           key=lambda i: products[i].get('price', 0) + products[i].get('shipping_fee', 0))
        
        # ìŠ¤íƒ€ì¼ë§ëœ í…Œì´ë¸” í‘œì‹œ
        st.markdown("#### ğŸ’° ê°€ê²© ë¹„êµí‘œ")
        
        # ìµœì €ê°€ í•˜ì´ë¼ì´íŠ¸
        def highlight_min_price(row):
            if row.name == min_price_idx:
                return ['background-color: #e8f5e8; font-weight: bold'] * len(row)
            return [''] * len(row)
        
        styled_df = df.style.apply(highlight_min_price, axis=1)
        st.dataframe(styled_df, use_container_width=True, hide_index=True)
        
        # ìµœì €ê°€ ì •ë³´
        min_price_product = products[min_price_idx]
        min_total = min_price_product.get('price', 0) + min_price_product.get('shipping_fee', 0)
        
        st.success(f"""
        ğŸ† **ìµœì €ê°€**: {min_price_product.get('shop', 'N/A')} - {min_total:,}ì›
        
        ğŸ’¡ **ì ˆì•½ ê¸ˆì•¡**: ìµœëŒ€ {self._calculate_max_savings(products):,}ì›ê¹Œì§€ ì ˆì•½ ê°€ëŠ¥!
        """)
        
        # ì¶”ì²œ ì´ìœ 
        self._show_recommendation(products, min_price_idx)
    
    def _calculate_max_savings(self, products: List[Dict[str, Any]]) -> int:
        """ìµœëŒ€ ì ˆì•½ ê¸ˆì•¡ ê³„ì‚°"""
        prices = [p.get('price', 0) + p.get('shipping_fee', 0) for p in products]
        return max(prices) - min(prices)
    
    def _show_recommendation(self, products: List[Dict[str, Any]], min_price_idx: int):
        """ì¶”ì²œ ì´ìœ  í‘œì‹œ"""
        min_price_product = products[min_price_idx]
        
        with st.expander("ğŸ¤” ì™œ ì´ ìƒí’ˆì„ ì¶”ì²œí•˜ë‚˜ìš”?"):
            reasons = []
            
            # ìµœì €ê°€
            reasons.append("ğŸ’° ê°€ì¥ ì €ë ´í•œ ê°€ê²©")
            
            # ë¬´ë£Œë°°ì†¡
            if min_price_product.get('shipping_fee', 0) == 0:
                reasons.append("ğŸšš ë¬´ë£Œë°°ì†¡")
            
            # ë†’ì€ í‰ì 
            rating = min_price_product.get('rating', 0)
            if rating >= 4.0:
                reasons.append(f"â­ ë†’ì€ í‰ì  ({rating:.1f}ì )")
            
            # ë§ì€ ë¦¬ë·°
            review_count = min_price_product.get('review_count', 0)
            if review_count >= 100:
                reasons.append(f"ğŸ“ ë§ì€ ë¦¬ë·° ({review_count:,}ê°œ)")
            
            # í• ì¸ìœ¨
            discount = min_price_product.get('discount_rate', 0)
            if discount > 10:
                reasons.append(f"ğŸ”¥ ë†’ì€ í• ì¸ìœ¨ ({discount:.1f}%)")
            
            for reason in reasons:
                st.write(f"â€¢ {reason}")
            
            if len(reasons) == 1:
                st.write("â€¢ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì‡¼í•‘ëª°")
```

### 5.6 API í´ë¼ì´ì–¸íŠ¸

#### API í´ë¼ì´ì–¸íŠ¸ (`src/ui/utils/api_client.py`)
```python
import aiohttp
import asyncio
import json
from typing import AsyncGenerator, Dict, Any
import streamlit as st

class APIClient:
    """API í´ë¼ì´ì–¸íŠ¸"""
    
    def __init__(self):
        self.base_url = "http://localhost:8000/api/v1"
        self.timeout = 30
    
    async def stream_chat(self, message: str, session_id: str) -> AsyncGenerator[Dict[str, Any], None]:
        """ì±„íŒ… ìŠ¤íŠ¸ë¦¬ë°"""
        url = f"{self.base_url}/chat"
        payload = {
            "message": message,
            "session_id": session_id
        }
        
        try:
            async with aiohttp.ClientSession() as session:
                async with session.post(
                    url,
                    json=payload,
                    headers={"Content-Type": "application/json"}
                ) as response:
                    if response.status == 200:
                        async for line in response.content:
                            if line.startswith(b'data: '):
                                try:
                                    data = json.loads(line[6:].decode('utf-8'))
                                    yield data
                                except json.JSONDecodeError:
                                    continue
                    else:
                        yield {
                            "type": "error",
                            "data": {"error": f"HTTP {response.status}"}
                        }
        
        except Exception as e:
            yield {
                "type": "error", 
                "data": {"error": str(e)}
            }
    
    async def upload_image(self, image_file, message: str, session_id: str) -> AsyncGenerator[Dict[str, Any], None]:
        """ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ê²€ìƒ‰"""
        url = f"{self.base_url}/chat/image"
        
        try:
            data = aiohttp.FormData()
            data.add_field('message', message)
            data.add_field('session_id', session_id)
            data.add_field('image', image_file, filename=image_file.name)
            
            async with aiohttp.ClientSession() as session:
                async with session.post(url, data=data) as response:
                    if response.status == 200:
                        async for line in response.content:
                            if line.startswith(b'data: '):
                                try:
                                    data = json.loads(line[6:].decode('utf-8'))
                                    yield data
                                except json.JSONDecodeError:
                                    continue
                    else:
                        yield {
                            "type": "error",
                            "data": {"error": f"HTTP {response.status}"}
                        }
        
        except Exception as e:
            yield {
                "type": "error",
                "data": {"error": str(e)}
            }
```

### 5.7 CSS ìŠ¤íƒ€ì¼

#### ë©”ì¸ CSS (`src/ui/styles/main.css`)
```css
/* ì „ì²´ ë ˆì´ì•„ì›ƒ */
.main .block-container {
    padding-top: 2rem;
    padding-bottom: 2rem;
    max-width: 1200px;
}

/* í—¤ë” ìŠ¤íƒ€ì¼ */
.header-container {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem;
    border-radius: 10px;
    margin-bottom: 2rem;
    text-align: center;
}

.header-content h1 {
    margin: 0;
    font-size: 2.5rem;
    font-weight: bold;
}

.header-content p {
    margin: 0.5rem 0 0 0;
    font-size: 1.2rem;
    opacity: 0.9;
}

/* ì±„íŒ… ì»¨í…Œì´ë„ˆ */
.chat-container {
    min-height: 400px;
    max-height: 600px;
    overflow-y: auto;
    padding: 1rem;
    border: 1px solid #e0e0e0;
    border-radius: 10px;
    background: #fafafa;
}

/* ì…ë ¥ ì»¨í…Œì´ë„ˆ */
.input-container {
    position: sticky;
    bottom: 0;
    background: white;
    padding: 1rem;
    border-top: 1px solid #e0e0e0;
    border-radius: 10px 10px 0 0;
    margin-top: 1rem;
}

/* ìƒí’ˆ ì¹´ë“œ */
.product-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.product-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15) !important;
}

/* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.stButton > button {
    border-radius: 20px;
    border: none;
    background: linear-gradient(45deg, #667eea, #764ba2);
    color: white;
    font-weight: bold;
    transition: all 0.3s ease;
}

.stButton > button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

/* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
.sidebar-content {
    background: white;
    border-radius: 10px;
    padding: 1rem;
    border: 1px solid #e0e0e0;
}

/* ìŠ¤í”¼ë„ˆ ì»¤ìŠ¤í„°ë§ˆì´ì§• */
.stSpinner > div {
    border-top-color: #667eea !important;
}

/* ë©”ì‹œì§€ ë²„ë¸” */
.chat-message {
    margin-bottom: 1rem;
}

/* ë°˜ì‘í˜• ë””ìì¸ */
@media (max-width: 768px) {
    .header-content h1 {
        font-size: 2rem;
    }
    
    .header-content p {
        font-size: 1rem;
    }
    
    .chat-container {
        max-height: 400px;
    }
}
```

## âœ… ì™„ë£Œ ê¸°ì¤€
- [ ] Streamlit ë©”ì¸ ì•± êµ¬í˜„
- [ ] ì „ì²´ í™”ë©´ ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
- [ ] ë©”ì‹œì§€ ë²„ë¸” ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- [ ] ìƒí’ˆ ì¹´ë“œ í‘œì‹œ ê¸°ëŠ¥ êµ¬í˜„
- [ ] ê°€ê²© ë¹„êµ í…Œì´ë¸” êµ¬í˜„
- [ ] ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì²˜ë¦¬
- [ ] ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ëŠ¥ êµ¬í˜„ (UIë§Œ)
- [ ] CSS ìŠ¤íƒ€ì¼ë§ ì™„ë£Œ
- [ ] API í´ë¼ì´ì–¸íŠ¸ ì—°ë™
- [ ] ë°˜ì‘í˜• ë””ìì¸ ì ìš©

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. Streamlit ì•± ì‹¤í–‰
```bash
# API ì„œë²„ ì‹¤í–‰ (ë³„ë„ í„°ë¯¸ë„)
python scripts/run_api.py

# Streamlit ì•± ì‹¤í–‰
streamlit run src/ui/streamlit_app.py
```

### 2. UI ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- ì±„íŒ… ì…ë ¥ í…ŒìŠ¤íŠ¸
- ìƒí’ˆ ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ í™•ì¸
- ìƒí’ˆ ì¹´ë“œ ë Œë”ë§ í™•ì¸
- ê°€ê²© ë¹„êµ í…Œì´ë¸” í™•ì¸
- ë°˜ì‘í˜• ë””ìì¸ í™•ì¸ (ëª¨ë°”ì¼/ë°ìŠ¤í¬í†±)

### 3. ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ í…ŒìŠ¤íŠ¸
- ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ í™•ì¸
- ìƒí’ˆ ì •ë³´ ì‹¤ì‹œê°„ í‘œì‹œ í™•ì¸
- ì—ëŸ¬ ì²˜ë¦¬ í™•ì¸

## ğŸ”— ë‹¤ìŒ ë‹¨ê³„
[Phase 2 Step 6 - ìŠ¤íŠ¸ë¦¬ë° API ì™„ì„±](mdc:.cursor/rules/tasks/phase2-step6-streaming-api.mdc)

## ğŸ“š ì°¸ê³  ë¬¸ì„œ
- [ê°œë°œ íƒœìŠ¤í¬ ê³„íš](mdc:.cursor/rules/development-task-plan.mdc)
- [UI/UX ì„¤ê³„ ê°€ì´ë“œ](mdc:.cursor/rules/ui_wireframe.mdc)
- [ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤](mdc:.cursor/rules/user-scenarios-design.mdc)

