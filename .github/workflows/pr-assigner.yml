name: PR ìë™ í• ë‹¹

on:
  pull_request:
    types: [opened, reopened]

jobs:
  auto-assign:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
      - name: PR ìë™ í• ë‹¹
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const prNumber = context.payload.pull_request.number;
            const repo = context.repo;
            const author = context.payload.pull_request.user.login;
            
            // PR ì‘ì„±ìë¥¼ ë‹´ë‹¹ìë¡œ ìë™ í• ë‹¹
            await github.rest.issues.addAssignees({
              owner: repo.owner,
              repo: repo.repo,
              issue_number: prNumber,
              assignees: [author]
            });
            
            // PRì˜ íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            const response = await github.rest.pulls.listFiles({
              owner: repo.owner,
              repo: repo.repo,
              pull_number: prNumber
            });
            
            const files = response.data;
            
            // ì½”ë“œ ì˜ì—­ë³„ ë‹´ë‹¹ì
            const codeAreaOwners = {
              'frontend': ['frontend-reviewer'],
              'src/api': ['backend-reviewer'],
              'src/agent': ['ai-reviewer'],
              'tests': ['qa-reviewer']
            };
            
            // ë³€ê²½ëœ íŒŒì¼ì˜ ì˜ì—­ì— ë”°ë¼ ë¦¬ë·°ì–´ ì„ íƒ
            const reviewers = new Set();
            
            files.forEach(file => {
              for (const [area, owners] of Object.entries(codeAreaOwners)) {
                if (file.filename.startsWith(area)) {
                  owners.forEach(owner => reviewers.add(owner));
                  break;
                }
              }
            });
            
            // ì‘ì„±ìë¥¼ ë¦¬ë·°ì–´ ëª©ë¡ì—ì„œ ì œì™¸
            reviewers.delete(author);
            
            // ë¦¬ë·°ì–´ í• ë‹¹ (ë¦¬ë·°ì–´ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ)
            if (reviewers.size > 0) {
              try {
                await github.rest.pulls.requestReviewers({
                  owner: repo.owner,
                  repo: repo.repo,
                  pull_number: prNumber,
                  reviewers: Array.from(reviewers)
                });
                
                console.log(`ë¦¬ë·°ì–´ í• ë‹¹ë¨: ${Array.from(reviewers).join(', ')}`);
              } catch (error) {
                console.error('ë¦¬ë·°ì–´ í• ë‹¹ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
              }
            }
            
            // PRì— ì½”ë©˜íŠ¸ ì¶”ê°€
            const comment = `### ğŸ¤– ìë™ í• ë‹¹ ì•Œë¦¼
            
            @${author}ë‹˜ì´ ì´ PRì˜ ë‹´ë‹¹ìë¡œ ìë™ í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤.
            
            ${reviewers.size > 0 ? `ë‹¤ìŒ ë¦¬ë·°ì–´ê°€ ìë™ìœ¼ë¡œ ì§€ì •ë˜ì—ˆìŠµë‹ˆë‹¤: ${Array.from(reviewers).map(r => '@' + r).join(', ')}` : 'ìë™ ë¦¬ë·°ì–´ í• ë‹¹ì´ ì´ë£¨ì–´ì§€ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë¦¬ë·°ì–´ë¥¼ ì§€ì •í•´ ì£¼ì„¸ìš”.'}
            
            > ë¦¬ë·°ì–´ëŠ” íŒŒì¼ ë³€ê²½ ì˜ì—­ì— ë”°ë¼ ìë™ìœ¼ë¡œ í• ë‹¹ë©ë‹ˆë‹¤. í•„ìš”í•œ ê²½ìš° ë¦¬ë·°ì–´ë¥¼ ìˆ˜ì •í•´ ì£¼ì„¸ìš”.`;
            
            await github.rest.issues.createComment({
              owner: repo.owner,
              repo: repo.repo,
              issue_number: prNumber,
              body: comment
            }); 